document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("lightbox");if(!e)return;const r=e.querySelector(".lb-image"),x=e.querySelector(".lb-caption"),S=e.querySelector(".lb-close"),T=e.querySelector(".lb-prev"),z=e.querySelector(".lb-next");let u=[],o=0,i=!1,t=1,n=0,s=0;const k=1,w=4,_=.15;let a=null,j=0,O=0,b=1,C=0,y=0,l=!1,m=0,g=0,h=0,p=0;const M=50;function d(){r.style.transform=`translate(${n}px, ${s}px) scale(${t})`}function A(e,t){return Math.hypot(t.clientX-e.clientX,t.clientY-e.clientY)}function f(){const t=r.getBoundingClientRect(),o=e.getBoundingClientRect(),i=Math.max(0,(t.width-o.width)/2),a=Math.max(0,(t.height-o.height)/2);n=Math.min(i,Math.max(-i,n)),s=Math.min(a,Math.max(-a,s))}function E(){t=1,n=0,s=0,r.style.transform=""}function F(t,n){i=!0,e.classList.remove("is-loaded");const s=new Image;s.onload=()=>{r.src=t,x.textContent=n,E(),e.classList.add("is-loaded"),i=!1},s.onerror=()=>{x.textContent="Impossible de charger lâ€™image",e.classList.add("is-loaded"),i=!1},s.src=t}function c(t){if(i)return;o=(t+u.length)%u.length;const n=u[o],s=n.dataset.src,a=n.dataset.caption||n.dataset.label||"";if(!s)return;e.hidden=!1,document.body.style.overflow="hidden",F(s,a)}function v(){e.hidden=!0,r.src="",e.classList.remove("is-loaded"),document.body.style.overflow="",E()}document.addEventListener("click",e=>{const t=e.target.closest("[data-lightbox]");if(!t||!t.dataset.src)return;e.preventDefault();const n=t.dataset.lightbox;u=[...document.querySelectorAll(`[data-lightbox="${n}"][data-src]`)],o=u.indexOf(t),c(o)}),S?.addEventListener("click",v),T?.addEventListener("click",()=>c(o-1)),z?.addEventListener("click",()=>c(o+1)),e.addEventListener("click",t=>{t.target===e&&v()}),document.addEventListener("keydown",t=>{if(e.hidden)return;t.key==="Escape"&&v(),t.key==="ArrowLeft"&&c(o-1),t.key==="ArrowRight"&&c(o+1)}),e.addEventListener("wheel",o=>{if(e.hidden||!o.ctrlKey||i)return;o.preventDefault();const c=t,a=e.getBoundingClientRect(),l=a.left+a.width/2,u=a.top+a.height/2,h=o.clientX,m=o.clientY;if(o.deltaY<0?t=Math.min(w,t+_):t=Math.max(k,t-_),t<=1.01){t=1,n=0,s=0,d();return}const r=t/c;n+=(h-l)*(1-r),s+=(m-u)*(1-r),f(),d()},{passive:!1}),e.addEventListener("mousedown",o=>{if(e.hidden||t<=1||i)return;if(o.button!==0)return;o.preventDefault(),l=!0,m=o.clientX,g=o.clientY,h=n,p=s,e.style.cursor="grabbing"}),window.addEventListener("mousemove",t=>{if(!l)return;if(!(t.buttons&1)){l=!1,e.style.cursor="";return}n=h+(t.clientX-m),s=p+(t.clientY-g),f(),d()}),window.addEventListener("mouseup",()=>{if(!l)return;l=!1,e.style.cursor=""}),e.addEventListener("touchstart",o=>{if(e.hidden||i)return;if(o.touches.length===2&&(a="pinch",O=A(o.touches[0],o.touches[1]),b=t,C=(o.touches[0].clientX+o.touches[1].clientX)/2,y=(o.touches[0].clientY+o.touches[1].clientY)/2),o.touches.length===1){const e=o.touches[0];t>1?(a="pan",l=!0,m=e.clientX,g=e.clientY,h=n,p=s):(a="swipe",j=e.clientX)}},{passive:!0}),e.addEventListener("touchmove",o=>{if(e.hidden||i)return;if(a==="pinch"&&o.touches.length===2){o.preventDefault();const r=t,c=A(o.touches[0],o.touches[1]),l=c/O;if(t=Math.min(w,Math.max(k,b*l)),t<=1.01){t=1,n=0,s=0,d();return}const i=e.getBoundingClientRect(),u=i.left+i.width/2,h=i.top+i.height/2,m=C,p=y,a=t/r;n+=(m-u)*(1-a),s+=(p-h)*(1-a),f(),d()}if(a==="pan"&&t>1&&o.touches.length===1){o.preventDefault();const e=o.touches[0];n=h+(e.clientX-m),s=p+(e.clientY-g),f(),d()}},{passive:!1}),e.addEventListener("touchend",n=>{if(e.hidden||i)return;if(a==="swipe"&&t===1){if(!n.changedTouches||n.changedTouches.length!==1)return;const e=n.changedTouches[0].clientX-j;(e<0?-e:e)>=M&&c(e>0?o-1:o+1)}a=null,l=!1}),r.addEventListener("dragstart",e=>e.preventDefault()),r.addEventListener("mousedown",e=>e.preventDefault())})